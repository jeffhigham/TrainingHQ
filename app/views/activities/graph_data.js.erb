//Dynamic content from the activity controller.
var power_numbers_time = <%= @javascript_data[:power_numbers_time] %>;
var heart_rate_numbers_time = <%= @javascript_data[:heart_rate_numbers_time] %> ;
var cadence_numbers_time = <%= @javascript_data[:cadence_numbers_time] %>;
var altitude_numbers_time = <%= @javascript_data[:altitude_numbers_time]  %>;
var speed_numbers_time = <%= @javascript_data[:speed_numbers_time]  %>;


var power_numbers_distance = <%= @javascript_data[:power_numbers_distance] %>;
var heart_rate_numbers_distance = <%= @javascript_data[:heart_rate_numbers_distance] %> ;
var cadence_numbers_distance = <%= @javascript_data[:cadence_numbers_distance] %>;
var altitude_numbers_distance = <%= @javascript_data[:altitude_numbers_distance]  %>;
var speed_numbers_distance = <%= @javascript_data[:speed_numbers_distance]  %>;


var power_numbers = power_numbers_time;
var heart_rate_numbers = heart_rate_numbers_time;
var cadence_numbers = cadence_numbers_time;
var altitude_numbers = altitude_numbers_time;
var speed_numbers = speed_numbers_time;


// Global variables.
var power_numbers_max = Array.max(power_numbers);
var power_numbers_min = Array.min(power_numbers);
var heart_rate_numbers_max = Array.max(heart_rate_numbers);
var heart_rate_numbers_min = Array.min(heart_rate_numbers);
var cadence_numbers_max = Array.max(cadence_numbers);
var cadence_numbers_min = Array.min(cadence_numbers);
var altitude_numbers_max= Array.max(altitude_numbers);
var altitude_numbers_min= Array.min(altitude_numbers);
var speed_numbers_max= Array.max(speed_numbers);
var speed_numbers_min= Array.min(speed_numbers);


var power_params = {
        'element_id': 'all_ride_data',
        'ymax': power_numbers_max,
        'ymin': power_numbers_min,
        'linewidth': 2,
        'colors': [power_color],
        'filled': true,
        'fillstyle': 'rgba(255,153,0,0.5)',
        'axis_x': 977,
        'axis_title': "Power (watts)",
        'axis_align': 'right',
        'axis_color': power_color,
        'axis_text_color': power_color
    };

var heart_rate_params = {
        'element_id': 'all_ride_data',
        'ymax': heart_rate_numbers_max,
        'ymin': heart_rate_numbers_min,
        'linewidth': 2,
        'colors': [hr_color],
        'filled': false,
        'fillstyle': 'rgba(255,86,0,0.5)',
        'axis_x': 1015,
        'axis_title': "Heart Rate (bpm)",
        'axis_align': 'right',
        'axis_color': hr_color,
        'axis_text_color': hr_color
    };

var altitude_params = {
        'element_id': 'all_ride_data',
        'ymax': altitude_numbers_max,
        'ymin': altitude_numbers_min,
        'linewidth': 2,
        'colors': [alt_color],
        'filled': true,
        'fillstyle': 'rgba(127,255,0,0.2)',
        'axis_x': 150,
        'axis_title': "Altitude (ft)",
        'axis_align': 'left',
        'axis_color': alt_color,
        'axis_text_color': alt_color
    };

var cadence_params = {
        'element_id': 'all_ride_data',
        'ymax': cadence_numbers_max,
        'ymin': cadence_numbers_min,
        'linewidth': 2,
        'colors': [cadence_color],
        'filled': false,
        'fillstyle': 'rgba(15,129,255,0.5)',
        'axis_x': 95,
        'axis_title': "Cadence (rpm)",
        'axis_align': 'left',
        'axis_color': cadence_color,
        'axis_text_color': cadence_color
    };

var speed_params = {
        'element_id': 'all_ride_data',
        'ymax': speed_numbers_max,
        'ymin': speed_numbers_min,
        'linewidth': 2,
        'colors': [speed_color],
        'filled': false,
        'fillstyle': 'rgba(15,129,255,0.5)',
        'axis_x': 50,
        'axis_title': "Speed (km/h)",
        'axis_align': 'left',
        'axis_color': speed_color,
        'axis_text_color': speed_color
    };



window.onload = function() {
    $('#speed_check').prop('checked',true);
    $('#cadence_check').prop('checked', true);
    $('#altitude_check').prop('checked',true);
    $('#power_check').prop('checked',true);
    $('#hr_check').prop('checked',true);
    drawScaled(5,'all_ride_data');
}

function drawScaled(scale_factor_passed, element_id)
{
    resetGraph(element_id);
    var scale_factor = 0;
    if(scale_factor_passed) {
        scale_factor = scale_factor_passed;
    }
    else {
        scale_factor = $('#graph_scale_slider').val();
    }
    
    speed_params['graph_data']      = maxValuesScaledBy(speed_numbers,scale_factor);    
    altitude_params['graph_data']   = maxValuesScaledBy(altitude_numbers,scale_factor);
    cadence_params['graph_data']    = maxValuesScaledBy(cadence_numbers,scale_factor);
    heart_rate_params['graph_data'] = maxValuesScaledBy(heart_rate_numbers,scale_factor);
    power_params['graph_data']      = maxValuesScaledBy(power_numbers,scale_factor);

    power_params['ymax'] = Array.max(power_params['graph_data']);
    power_params['ymin'] = Array.min(power_params['graph_data']);
    heart_rate_params['ymax'] = Array.max(heart_rate_params['graph_data']);
    heart_rate_params['ymin'] = Array.min(heart_rate_params['graph_data']);
    cadence_params['ymax']  = Array.max(cadence_params['graph_data'] );
    cadence_params['ymin']   = Array.min(cadence_params['graph_data'] );
    altitude_params['ymax'] = Array.max(altitude_params['graph_data']);
    altitude_params['ymin'] = Array.min(altitude_params['graph_data']);
    speed_params['ymax'] = Array.max(speed_params['graph_data']);
    speed_params['ymin'] = Array.min(speed_params['graph_data']);


    if ( $('#altitude_check').is(':checked') && altitude_numbers_max > 0 ){
        drawLinePlot(altitude_params);
    }
    if ( $('#cadence_check').is(':checked') && cadence_numbers_max > 0 ){
        drawLinePlot(cadence_params);
    }
    if ( $('#hr_check').is(':checked') && heart_rate_numbers_max > 0 ){
        drawLinePlot(heart_rate_params);
    }
    if ( $('#power_check').is(':checked') && power_numbers_max > 0 ){
        drawLinePlot(power_params);
    }
    if ( $('#speed_check').is(':checked') && speed_numbers_max > 0 ){
        drawLinePlot(speed_params);
    }

}

function handleSelect(){

    if( $('select#graph_dataset_option').val() == "time"){
        power_numbers = power_numbers_time;
        heart_rate_numbers = heart_rate_numbers_time;
        cadence_numbers = cadence_numbers_time;
        altitude_numbers = altitude_numbers_time;
        speed_numbers = speed_numbers_time;
    }
    else {
        power_numbers = power_numbers_distance;
        heart_rate_numbers = heart_rate_numbers_distance;
        cadence_numbers = cadence_numbers_distance;
        altitude_numbers = altitude_numbers_distance;
        speed_numbers = speed_numbers_distance;
    }
    

    drawScaled(false,'all_ride_data');
}
